## 项目需求分析

### 1. 项目背景与目标

- 行业背景：P2P 网贷平台需要评估借款人的违约风险，降低逾期造成的资金损失。
- 项目目标：基于提供的 LC、LP、LCIS 三类数据，构建违约预测模型，判断借款人在贷款周期内是否会发生逾期，并形成完整的开发与交付流程。

### 2. 相关方及角色职责

- **客户**
  - 定义业务场景、指标与验收标准，提出追加需求。
  - 在交付阶段对模型效果和报告进行验收与反馈。
- **项目经理**
  - 统筹需求、排期、交付里程碑，协调团队沟通。
  - 管控项目质量、风险，并确保按期交付。
- **数据科学家**
  - 分析数据资产质量，设计数据清洗与特征工程策略。
  - 输出数据处理方案与可复现流程。
- **机器学习算法工程师**
  - 实现模型训练、调参与部署脚本。
  - 包含基线模型与提升模型至少两类。
- **测试工程师**
  - 设计并执行模型测试计划与评估指标。
  - 负责测试报告与缺陷跟踪。

### 3. 业务需求

1. **违约预测**：判断借款人在借款周期内是否会逾期，形成可解释结果。
2. **行业与场景描述**：客户需提供具体业务场景设定与核心指标要求。
3. **跨角色协同**：五个角色分别输出阶段性报告与最终总结，以形成完整项目文档。
4. **模型可迭代优化**：交付的代码与流程需支持在不同模型、数据集上快速切换调优。

### 4. 功能需求

- **数据处理**
  - 描述三张表的字段结构、业务含义及相互关系（LC ↔ LP 一一对应，LCIS 为逾期快照补充）。
  - 先对 LC、LP、LCIS 进行清洗：认证字段二值化、非法状态剔除、金额/期数 P99 截尾、年龄区间裁剪等。正常还款比等派生指标推迟到特征工程阶段统一生成。
  - 构建标签：在清洗结果上，以 LP 聚合后的 `sum_DPD` 判定是否逾期（贷款周期已走完且 `sum_DPD>0` ⇒ 违约），并追加 LCIS 最新 `recorddate` 仍为“逾期中”的合同；输出 `LC_labeled_samples.csv`（有效样本）与 `LC_invalid_samples.csv`（未到期样本）供追踪。
  - 完成缺失值、异常值处理与数据一致性校验，并记录到 `outputs/middata/` 与日志；一致性校验包括 `借款金额` ↔ LP `应还本金` 汇总、`借款期限` ↔ LP 最大期数，违规条目需单独导出。
  - 提取时间特征、类别特征编码、数值特征归一化。
- **特征工程**
  - 构造正常还款比、历史逾期率、还款能力、借款金额与收入代理比值等派生特征。
  - 评估特征重要性，进行特征选择（相关系数、卡方、模型重要性等方法）。
- **模型训练**
  - 至少训练两类模型：逻辑回归（基线）+ 树模型（如随机森林、XGBoost）。
  - 划分训练/验证/测试集（70%/15%/15%）。
  - 执行超参数搜索（例如 GridSearchCV）。
- **模型评估**
  - 计算 Accuracy、Precision、Recall、F1、ROC-AUC 等指标。
  - 绘制 ROC 曲线、混淆矩阵等可视化。
  - 对比模型性能并解释差异。
- **测试与验收**
  - 测试工程师制定测试用例，验证模型输出符合需求。
  - 输出测试报告与建议。
- **报告与交付**
  - 汇总各角色工作报告与项目总结。
  - 提供代码、清洗后的数据集压缩包、最终报告。

### 5. 数据需求与约束

- 数据来源：`data/raw/source_data/` 中的 LC.csv、LP.csv、LCIS.csv 及字典说明。
- 标签生成规则：
  1. 清洗后的 LP 按 `ListingId` 聚合，计算贷款周期内的 `sum_DPD`。若借款理论到期日 < LP 最新 `recorddate` 且 `sum_DPD > 0`，标签记为 1；`sum_DPD = 0` 记为 0。
  2. 对于贷款周期尚未走完但 LCIS 最新 `标当前状态` 为“逾期中”的合同，强制补充为负样本（标签=1），同时回填 LCIS 中的同名字段。
  3. 未到期样本（借款理论到期日 ≥ `recorddate`）导出至 `LC_invalid_samples.csv` 供业务抽查，不参与建模。
- 数据处理要求：
  - 清洗不可用或异常记录（年龄极值、金额异常、非法状态、认证噪声等），并在日志与 `middata` 输出中记录影响比例；
  - 对 `借款金额` 与 LP `应还本金` 汇总、`借款期限` 与 LP 最大期数执行一致性校验，生成 `principal_inconsistencies.csv`、`term_inconsistencies.csv` 等备查文件；
  - 保留数据可追溯性；清洗结果与样本文件输出到 `outputs/middata/`，最终特征表输出到 `data/interim/` 与 `data/processed/`。
- 数据安全性：敏感信息仅用于建模，需注明保密承诺。

### 6. 非功能需求

- **可复现性**：构建虚拟环境（requirements/environment 文件），保证跨设备一致执行。
- **可维护性**：模块化代码结构，配置化参数，提供清晰文档。
- **性能**：模型训练需在合理时间内完成（根据数据规模评估），支持批量预测。
- **版本管理**：使用 Git（或等效方式）追踪代码与文档修改历史。

### 7. 里程碑与交付清单

1. 需求澄清与项目规划。
2. 数据理解与预处理方案设计。
3. 特征工程与模型方案设计。
4. 模型训练、调优与评估。
5. 测试验证与可视化输出。
6. 交付准备（报告、代码、数据打包）。

**最终交付物**：

- 清洗后的数据集 ZIP 包。
- 可运行的模型训练与评估代码，并附依赖说明。
- 小组综合报告（包含所有角色工作内容与项目总结）。

### 8. 风险与应对

- 数据质量较低（缺失、异常多）：
  - 方案：统计缺失模式，设计合理填补策略，记录处理过程。
- 标签生成存在歧义：
  - 方案：多策略交叉验证，记录逻辑并在报告中说明假设。
- 模型欠拟合或过拟合：
  - 方案：尝试多模型与正则化、交叉验证等手段。
- 进度风险：
  - 方案：制定阶段性里程碑，定期同步进展。

### 9. 验收标准

- 技术指标：测试集上至少达到设定的最低性能要求（由客户与 PM 协商，建议 ROC-AUC > 0.70 作为初始目标）。
- 文档完备：包含需求、设计、实验、测试、总结，结构符合学术论文标准。
- 可运行性：提供一键执行脚本或流水线，验证代码可在虚拟环境中复现结果。
- 角色总结：五位角色均提交个人总结，体现合作过程与贡献。
